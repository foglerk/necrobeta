!function(a,e){
"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@alt1/base")):"function"==typeof define&&define.amd?define(["@alt1/base"],e):"object"==typeof exports?exports["@alt1/ocr"]=e(require("@alt1/base")):a.OCR=e(a.A1lib)
}("undefined"!=typeof self?self:this,(a=>(()=>{"use strict";var e=[,e=>{e.exports=a}],t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.n=a=>{
var e=a&&a.__esModule?()=>a.default:()=>a;return r.d(e,{a:e}),e},r.d=(a,e)=>{for(var t in e)r.o(e,t)&&!r.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})},r.o=(a,e)=>Object.prototype.hasOwnProperty.call(a,e),r.r=a=>{
"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var i={};return(()=>{r.r(i),r.d(i,{GetChatColorMono:()=>x,canblend:()=>d,debug:()=>e,
debugFont:()=>n,debugout:()=>t,decompose2col:()=>l,decompose3col:()=>u,decomposeblack:()=>c,findChar:()=>f,findReadLine:()=>p,generatefont:()=>m,getChatColor:()=>w,readChar:()=>y,readLine:()=>v,readSmallCapsBackwards:()=>b,
unblendBlackBackground:()=>o,unblendKnownBg:()=>h,unblendTrans:()=>s});var a=r(1),e={printcharscores:!1,trackread:!1},t={};function n(e){
for(var t=e.width+2,r=new a.ImageData(t*e.chars.length,e.height+1),i=0;i<r.data.length;i+=4)r.data[i]=r.data[i+1]=r.data[i+2]=0,r.data[i+3]=255
;for(i=0;i<e.chars.length;i++)for(var n=i*t,o=e.chars[i],h=0;h<o.pixels.length;h+=e.shadow?4:3)r.setPixel(n+o.pixels[h],o.pixels[h+1],[o.pixels[h+2],o.pixels[h+2],o.pixels[h+2],255]),
e.shadow&&r.setPixel(n+o.pixels[h],o.pixels[h+1],[o.pixels[h+3],0,0,255]);r.show()}function o(e,t,r,i){for(var n=new a.ImageData(e.width,e.height),o=0;o<e.data.length;o+=4){var h=c(e.data[o],e.data[o+1],e.data[o+2],t,r,i);n.data[o+0]=255*h[0],
n.data[o+1]=n.data[o+0],n.data[o+2]=n.data[o+0],n.data[o+3]=255}return n}function h(e,t,r,i,n,o){if(t&&(e.width!=t.width||e.height!=t.height))throw"bgimg size doesn't match";for(var h=new a.ImageData(e.width,e.height),s=0;s<e.data.length;s+=4){
var d=l(e.data[s],e.data[s+1],e.data[s+2],i,n,o,t.data[s+0],t.data[s+1],t.data[s+2]);if(r){d[2]>.01&&console.log("high error component: "+(100*d[2]).toFixed(1)+"%"),d[2];var c=1-d[1]-Math.abs(d[2]);h.data[s+0]=255*c,h.data[s+1]=d[0]/c*255,
h.data[s+2]=h.data[s+0]}else h.data[s+0]=255*d[0],h.data[s+1]=h.data[s+0],h.data[s+2]=h.data[s+0];h.data[s+3]=255}return h}function s(e,t,r,i,n){for(var o=new a.ImageData(e.width,e.height),h=r+i+n,s=0;s<e.data.length;s+=4){if(t){
var d=e.data[s+0]+e.data[s+1]+e.data[s+2];o.data[s+0]=e.data[s+3],o.data[s+1]=d/h*255,o.data[s+2]=o.data[s+0]}else o.data[s+0]=e.data[s+3],o.data[s+1]=o.data[s+0],o.data[s+2]=o.data[s+0];o.data[s+3]=255}return o}function d(a,e,t,r,i,n,o){
var h=Math.min(50,o/(1-o)),s=a+(a-r)*h,d=e+(e-i)*h,l=t+(t-n)*h;return Math.max(0,-s,-d,-l,s-255,d-255,l-255)}function l(a,e,t,r,i,n,o,h,s){var d=i*s-h*n,l=n*o-s*r,c=r*h-o*i,f=255/Math.sqrt(d*d+l*l+c*c);return u(a,e,t,r,i,n,o,h,s,d*=f,l*=f,c*=f)}
function c(a,e,t,r,i,n){var o=Math.abs(a-r),h=Math.abs(e-i),s=Math.abs(t-n);return[1-Math.max(o,h,s)/255]}function u(a,e,t,r,i,n,o,h,s,d,l,c){var u=h*c-s*l,f=s*d-o*c,p=o*l-h*d,x=r*u+i*f+n*p
;return[(u*a+f*e+p*t)/x,((l*n-c*i)*a+(c*r-d*n)*e+(d*i-l*r)*t)/x,((i*s-n*h)*a+(n*o-r*s)*e+(r*h-i*o)*t)/x]}function f(a,e,t,r,i,n,o){if(r<0)return null;if(i-e.basey<0)return null;if(r+n+e.width>a.width)return null
;if(i+o-e.basey+e.height>a.height)return null;for(var h=1e3,s=null,d=r;d<r+n;d++)for(var l=i;l<i+o;l++){var c=y(a,e,t,d,l,!1,!1);null!=c&&c.sizescore<h&&(h=c.sizescore,s=c)}return s}function p(e,t,r,i,n,o=-1,h=-1){-1==o&&(o=t.width+t.spacewidth,
i-=Math.ceil(o/2)),-1==h&&(h=7,n-=1);var s=null;if(r.length>1)for(var d=x(e,new a.Rect(i,n-t.basey,o,h),r),l=0;l<2&&l<d.length&&null==s;l++)s=f(e,t,d[l].col,i,n,o,h);else s=f(e,t,r[0],i,n,o,h);return null==s?{debugArea:{x:i,y:n,w:o,h},text:"",
fragments:[]}:v(e,t,r,s.x,s.y,!0,!0)}function x(a,e,t){var r=t.map((a=>({col:a,score:0})));if(e.x<0||e.y<0||e.x+e.width>a.width||e.y+e.height>a.height)return r;var i=a.data;for(var n of r){
for(var o=0,h=n.col,s=e.y;s<e.y+e.height;s++)for(var d=e.x;d<e.x+e.width;d++){var l=4*d+4*s*a.width,c=Math.abs(i[l]-h[0])+Math.abs(i[l+1]-h[1])+Math.abs(i[l+2]-h[2]);c<50&&(o+=50-c)}n.score=o}return r.sort(((a,e)=>e.score-a.score))}
function g(a,e,t,r,i,n){var o=Math.sqrt(a*a+e*e+t*t),h=Math.sqrt(r*r+i*i+n*n),s=(a*r+e*i+t*n)/h,d=Math.sqrt(Math.max(0,o*o-s*s)),l=Math.max(0,4*(63.75-d)),c=s/h*255;return c>255&&(l=Math.max(0,l-c+255),c=255),[l,c]}function w(a,e,t){
var r=-1,i=null,n=0,o=a.data;for(let u of t){for(var h=0,s=e.y;s<e.y+e.height;s++)for(var d=e.x;d<e.x+e.width;d++){if(d<0||d+1>=a.width)continue;if(s<0||s+1>=a.width)continue;let e=a.pixelOffset(d,s),t=a.pixelOffset(d+1,s+1)
;var l=g(o[e+0],o[e+1],o[e+2],u[0],u[1],u[2]),c=g(o[t+0],o[t+1],o[t+2],u[0],u[1],u[2]);h+=l[0]/255*l[1]/255*(c[0]/255*(255-c[1])/255)}h>r?(n=r,r=h,i=u):h>n&&(n=h)}return i}function v(a,e,t,r,i,n,o=!1){"number"!=typeof t[0]&&1==t.length&&(t=t[0])
;var h="number"!=typeof t[0],s=h?t:[t],d=function(t,r,i){var n=Math.floor(1.5*e.width);return i&&(t-=n),r-=e.basey,w(a,{x:t,y:r,width:n,height:e.height},s)},l=[],c=r,u=r,f="number"==typeof e.maxspaces?e.maxspaces:1;let p="",x=!1;var g=null;let v=a=>{
if(!p)return;let e={text:p,color:g,index:0,xstart:r+(a?M:z),xend:r+(a?z:M)};a?l.push(e):l.unshift(e),p="",M=m,x=!1};for(var b of[!0,!1])if((!b||n)&&(b||o)){for(var m=0,M=m,z=m,O=0,k=!1,j=h?null:t;;){var C=(j=j||d(r+m,i,!b))?y(a,e,j,r+m,i,!b,!0):null
;if(null==j||null==C){if(O<f){m+=(b?1:-1)*e.spacewidth,O++;continue}if(h&&!k&&x){m-=(b?1:-1)*O*e.spacewidth,O=0,j=null,k=!0;continue}b?u=r+m-e.spacewidth:c=r+m+e.spacewidth;break}!g||j[0]==g[0]&&j[1]==g[1]&&j[2]==g[2]||v(b)
;for(var P="",S=0;S<O;S++)P+=" ";b?p+=P+C.chr:p=C.chr+P+p,C.basechar.secondary||(x=!0),O=0,k=!1,m+=(b?1:-1)*C.basechar.width,z=m,g=j}g&&x&&v(b)}return l.forEach(((a,e)=>a.index=e)),{debugArea:{x:c,y:i-9,w:u-c,h:10},text:l.map((a=>a.text)).join(""),
fragments:l}}function b(e,t,r,i,n,o=-1,h=-1){-1==o&&(o=t.width+t.spacewidth,i-=Math.ceil(o/2)),-1==h&&(h=7,n-=1);for(var s=null,d=1==r.length?[{col:r[0],score:1
}]:x(e,new a.Rect(i,n-t.basey,o,h),r),l=0;l<2&&l<d.length&&null==s;l++)for(var c=i+o-1;c>=i;c--){for(var u=1e3,f=null,p=n;p<n+h;p++){var g=y(e,t,d[l].col,c,p,!0,!1);null!=g&&g.sizescore<u&&(u=g.sizescore,f=g)}if(f){s=f;break}}return null==s?{text:"",
debugArea:{x:i,y:n,w:o,h}}:v(e,t,r,s.x,s.y,!1,!0)}function y(r,i,n,o,h,s,l){h-=i.basey;var c=i.basey,u=i.shadow,f=null,p=null;if(e.trackread){var x=o+";"+h+" "+JSON.stringify(n);t[x]||(t[x]=[]),f=t[x]}if(h<0||h+i.height>=r.height)return null;if(s){
if(o-i.width<0||o>r.width)return null}else if(o<0||o+i.width>r.width)return null;for(var g=[],w=0;w<i.chars.length;w++){var v=i.chars[w];if(!v.secondary||l){g[w]={score:0,sizescore:0,chr:v};var b=s?o-v.width:o
;e.trackread&&(p=new a.ImageData(i.width,i.height));for(var y=0;y<v.pixels.length;){var m=4*(b+v.pixels[y])+(h+v.pixels[y+1])*r.width*4,M=0;if(u){var z=v.pixels[y+3]/255;M=d(r.data[m],r.data[m+1],r.data[m+2],n[0]*z,n[1]*z,n[2]*z,v.pixels[y+2]/255),
y+=4}else M=d(r.data[m],r.data[m+1],r.data[m+2],n[0],n[1],n[2],v.pixels[y+2]/255),y+=3;g[w].score+=Math.max(0,M),p&&p.setPixel(v.pixels[y],v.pixels[y+1],[M,M,M,255])}g[w].sizescore=g[w].score-v.bonus,f&&f.push({chr:v.chr,score:g[w].sizescore,
rawscore:g[w].score,img:p})}}g.sort(((a,e)=>a.sizescore-e.sizescore)),e.printcharscores&&g.slice(0,5).forEach((a=>console.log(a.chr.chr,a.score.toFixed(3),a.sizescore.toFixed(3))));var O=g[0];return!O||O.score>400?null:{chr:O.chr.chr,basechar:O.chr,
x:o+0,y:h+c,score:O.score,sizescore:O.sizescore}}function m(a,e,t,r,i,n,o,h){o*=255;for(var s=a.height-1,d=0,l={chars:[],width:0,spacewidth:n,shadow:h,height:0,basey:0},c=!1,u=[],f=0;f<a.width;f++){var p=4*f+4*a.width*(a.height-1)
;if(255==a.data[p]&&255==a.data[p+3])!1===c&&(c=f);else if(!1!==c){var x=f,g=e[u.length],w={ds:c,de:x,width:x-c,chr:g,bonus:r&&r[g]||0,secondary:-1!=t.indexOf(e[u.length]),pixels:[]};for(u.push(w),l.width=Math.max(l.width,w.width),
b=0;b<x-c;b++)for(y=0;y<a.height-1;y++){p=4*(b+c)+y*a.width*4;a.data[p]>=o&&(s=Math.min(s,y),d=Math.max(d,y))}c=!1}}for(var v in l.height=d+1-s,l.basey=i-s,u){w=u[v];for(var b=0;b<w.width;b++)for(var y=0;y<d+1-s;y++){p=4*(b+w.ds)+(y+s)*a.width*4
;a.data[p]>=o&&(w.pixels.push(b,y),w.pixels.push(a.data[p]),h&&w.pixels.push(a.data[p+1]),w.bonus+=5)}w.bonus=+w.bonus.toFixed(3),l.chars.push({width:w.width,bonus:w.bonus,chr:w.chr,pixels:w.pixels,secondary:w.secondary})}return l}})(),i})()));
//# sourceMappingURL=index.bundle.js.map